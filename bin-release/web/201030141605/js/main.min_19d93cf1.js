function newInstance(e,t){return new e(t)}function getConfigurableByType(e){var t=type2nameMap[e];return t?configuableMap[t]:(console.log("no cofiguarable found.type:"+e),null)}var __reflect=this&&this.__reflect||function(e,t,n){e.__class__=t,n?n.push(t):n=[t],e.__types__=e.__types__?n.concat(e.__types__):n},__extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a]);n.prototype=t.prototype,e.prototype=new n},__awaiter=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))(function(i,s){function r(e){try{h(a.next(e))}catch(t){s(t)}}function o(e){try{h(a["throw"](e))}catch(t){s(t)}}function h(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(r,o)}h((a=a.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function n(e){return function(t){return a([e,t])}}function a(n){if(i)throw new TypeError("Generator is already executing.");for(;h;)try{if(i=1,s&&(r=s[2&n[0]?"return":n[0]?"throw":"next"])&&!(r=r.call(s,n[1])).done)return r;switch(s=0,r&&(n=[0,r.value]),n[0]){case 0:case 1:r=n;break;case 4:return h.label++,{value:n[1],done:!1};case 5:h.label++,s=n[1],n=[0];continue;case 7:n=h.ops.pop(),h.trys.pop();continue;default:if(r=h.trys,!(r=r.length>0&&r[r.length-1])&&(6===n[0]||2===n[0])){h=0;continue}if(3===n[0]&&(!r||n[1]>r[0]&&n[1]<r[3])){h.label=n[1];break}if(6===n[0]&&h.label<r[1]){h.label=r[1],r=n;break}if(r&&h.label<r[2]){h.label=r[2],h.ops.push(n);break}r[2]&&h.ops.pop(),h.trys.pop();continue}n=t.call(e,h)}catch(a){n=[6,a],s=0}finally{i=r=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,s,r,o,h={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o},RebounceObj=function(e){function t(){var t=e.call(this)||this;return t.deleteOnHit=!1,t}return __extends(t,e),t.prototype.onHit=function(e){var t=((new Date).getTime(),this.getTransformedBounds(GameManager.getInstance().stage).clone());t.inflate(e.width/2,e.height/2);var n=this.calcPoints(t,e);if(n.length>0){var a=this.calcFirstIntersecPoint(n,e);if(null!=a){if(a.x==t.left||a.x==t.right?e.resetXSpeed(a.x==t.right):(a.y==t.top||a.y==t.bottom)&&e.resetYSpeed(a.y==t.bottom),this.deleteOnHit){this.onDelete();var i=GameManager.getInstance().entityMap[this.getName()].indexOf(this);i>=0&&GameManager.getInstance().entityMap[this.getName()].splice(i,1),GameManager.getInstance().stage.removeChild(this)}}}},t.prototype.onDelete=function(){},t.prototype.calcPoints=function(e,t){var n=[],a=[],i=e.left,s=e.bottom,r=e.right,o=e.top;if(0!=t.speedX){var h=t.speedY/t.speedX,g=t.y-t.x*h;if(h!=Number.POSITIVE_INFINITY&&h!=Number.NEGATIVE_INFINITY){var c=new egret.Point(i,h*i+g),l=new egret.Point(r,h*r+g);c.equals(l)?n.push(c):(n.push(c),n.push(l))}if(0!=h){var u=new egret.Point((o-g)/h,o),p=new egret.Point((s-g)/h,s);u.equals(p)?n.push(u):(n.push(u),n.push(p))}}else{var u=new egret.Point(t.x,o),p=new egret.Point(t.x,s);n.push(u),n.push(p)}for(var d=0,f=n;d<f.length;d++){var v=f[d];v.x<i||v.x>r||v.y<o||v.y>s||a.push(v)}return a},t.prototype.calcFirstIntersecPoint=function(e,t){if(e.length<2)return null;var n=e[0],a=e[1];return 0==t.speedX&&0==t.speedY?(console.log("ball speedX and speedY =0"),null):t.speedY>0?n.y>a.y?a:n:t.speedY<0?n.y>a.y?n:a:t.speedX>0?n.x>a.x?a:n:t.speedX<0?n.x>a.x?n:a:void 0},t.count=0,t}(egret.Sprite);__reflect(RebounceObj.prototype,"RebounceObj",["IFlexible","IConfigurable"]);var Brick=function(e){function t(n){var a=e.call(this)||this,i=GameManager.getInstance().stage.stage.stageWidth,s=GameManager.getInstance().stage.stage.stageHeight;a.x=n.x*i,a.y=n.y*s,a.name=a.getName(),a.deleteOnHit=!0;var r=t.picName.length+t.aniName.length,o=Math.floor(Math.random()*r);if(o<t.picName.length){var h=new egret.Bitmap;h.texture=RES.getRes(t.picName[o]),h.width=n.width*i,h.height=n.height*s,h.fillMode=egret.BitmapFillMode.SCALE,a.addChild(h)}else{var g=GameManager.getInstance().stage.stage.mcFactory,c=new egret.MovieClip(g.generateMovieClipData(t.aniName[o-t.picName.length]));c.scaleX=n.width*i/c.width,c.scaleY=n.height*s/c.height,a.addChild(c),c.gotoAndPlay(0,-1)}return a}return __extends(t,e),t.prototype.getName=function(){return BRICK},t.prototype.onDelete=function(){var e=this.stage.mcFactory,t=new egret.MovieClip(e.generateMovieClipData("BRICK_DEAD")),n=this.width/t.width,a=this.height/t.height;t.scaleX=n,t.scaleY=a,t.x=this.x,t.y=this.y;var i=this.stage;i.addChild(t),t.gotoAndPlay(0,1),t.addEventListener(egret.Event.COMPLETE,function(){i.removeChild(t)},t)},t.picName=["BRICK_PEOPLE","BRICK_GIRL","BRICK_TSHIRT"],t.aniName=["BRICK_FBI","BRICK_HUAJI"],t}(RebounceObj);__reflect(Brick.prototype,"Brick");var Wall=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.getName=function(){return WALL},t}(RebounceObj);__reflect(Wall.prototype,"Wall");var ThemeAdapter=function(){function e(){}return e.prototype.getTheme=function(e,t,n,a){function i(e){t.call(a,e)}function s(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,s,null),n.call(a))}var r=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){t.call(a,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(e,n){window.JSONParseClass.setData(e),egret.callLater(function(){t.call(a,generateEUI2)},r)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(e.indexOf(".exml")>-1){var o=e.split("/");o.pop();var h=o.join("/")+"_EUI.json";generateJSON.paths[e]?egret.callLater(function(){t.call(a,generateJSON.paths[e])},this):RES.getResByUrl(h,function(n){window.JSONParseClass.setData(n),egret.callLater(function(){t.call(a,generateJSON.paths[e])},r)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){t.call(a,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,s,null),RES.getResByUrl(e,i,this,RES.ResourceItem.TYPE_TEXT)},e}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var Ball=function(e){function t(t,n){var a=e.call(this)||this;a.speedX=0,a.speedY=0,a.canMove=!0,a.collitionTag=-1,a.name="ball",a.x=t,a.y=n;var i=RES.getRes("myGame_json");a.backStage=GameManager.getInstance().stage;var s=2*i.ballRadius,r=2*i.ballRadius;a.width=s,a.height=r,a.anchorOffsetX=i.ballRadius,a.anchorOffsetY=i.ballRadius;var o=a.backStage.stage.mcFactory,h=new egret.MovieClip(o.generateMovieClipData("ball")),g=a.width/h.width,c=a.height/h.height;return h.scaleX=g,h.scaleY=c,a.addChild(h),h.gotoAndPlay(0,-1),a}return __extends(t,e),t.prototype.update=function(e){this.x+=this.speedX,this.y+=this.speedY,(this.y<=0&&this.speedY<0||this.y>this.backStage.height&&this.speedY>0)&&(this.speedY=-this.speedY),this.x<=0&&this.speedX<0?this.speedX=-this.speedX:this.x>this.backStage.width&&this.speedX>0&&(this.speedX=-this.speedX)},t.prototype.resetXSpeed=function(e){e?this.speedX=Math.abs(this.speedX):this.speedX=-Math.abs(this.speedX)},t.prototype.resetYSpeed=function(e){e?this.speedY=Math.abs(this.speedY):this.speedY=-Math.abs(this.speedY)},t.prototype.getName=function(){return BALL},t}(egret.Sprite);__reflect(Ball.prototype,"Ball",["IMovable","IConfigurable"]);var Bat=function(e){function t(t){var n=e.call(this)||this,a=t.stage.stageWidth,i=t.stage.stageHeight;n.name="bat";var s=RES.getRes("myGame_json");return n.graphics.beginFill(parseInt(s.batColor),1),n.graphics.drawRect(0,0,s.batWidth,s.batHeight),n.width=s.batWidth,n.height=s.batHeight,n.x=a/2,n.y=.8*i,n.anchorOffsetX=n.width/2,n.graphics.endFill(),n}return __extends(t,e),t.prototype.getName=function(){return BAT},t.prototype.onHit=function(e){var t=this.getTransformedBounds(GameManager.getInstance().stage),n=t.clone();n.inflate(e.width/2,e.height/2);var a=this.calcPoints(n,e);if(a.length>0){var i=this.calcFirstIntersecPoint(a,e);if(null!=i){if(i.x==n.left||i.x==n.right)e.resetXSpeed(i.x==n.right);else if(i.y==n.top||i.y==n.bottom){var s=(n.left+n.right)/2;if(i.x!=s){var r=e.speedX/Math.abs(e.speedX);i.x<s&&e.speedX>=0?r=-1:i.x>s&&e.speedX<=0&&(r=1);var o=Math.pow(e.speedX,2)+Math.pow(e.speedY,2),h=Math.abs(s-i.x),g=1-h/n.width*2,c=4/9*Math.PI*g+(i.x>s?Math.PI/18:Math.PI/2);e.speedX=r*Math.abs(Math.sqrt(o/(1+Math.pow(Math.tan(c),2)))),e.speedY=-1*Math.abs(Math.tan(c)*e.speedX),e.speedY>0}else e.resetYSpeed(!1)}if(this.deleteOnHit){var l=GameManager.getInstance().entityMap[this.getName()].indexOf(this);l>=0&&GameManager.getInstance().entityMap[this.getName()].splice(l,1),GameManager.getInstance().stage.removeChild(this)}}}},t}(RebounceObj);__reflect(Bat.prototype,"Bat");var AssetAdapter=function(){function e(){}return e.prototype.getAsset=function(e,t,n){function a(a){t.call(n,a,e)}if(RES.hasRes(e)){var i=RES.getRes(e);i?a(i):RES.getResAsync(e,a,this)}else RES.getResByUrl(e,a,this,RES.ResourceItem.TYPE_IMAGE)},e}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var GameManager=function(){function e(){this.balls=[],this.entityMap={},this.debugLine=new egret.Shape}return e.getInstance=function(){return e.gm},e.prototype.addToEntityMap=function(e){if(null!=this.entityMap[e.getName()])this.entityMap[e.getName()].push(e);else{var t=new Array;t.push(e),this.entityMap[e.getName()]=t}},e.prototype.init=function(e,t){this.stage=e},e.prototype.stageSuccess=function(){this.finished=!0,console.log("stage success"),this.stage.dispatchEvent(GameProcessEvent.newInstance("STAGE_END",!0)),StageMng.getInstance().isLastStage()&&this.stage.dispatchEvent(GameProcessEvent.newInstance("GAME_END",!0))},e.prototype.isStageSuccess=function(){return this.finished?!1:null!=this.entityMap[BRICK]?this.entityMap[BRICK].length<=0:!0},e.prototype.isStageFail=function(){return this.finished?!1:this.balls.length<=0},e.prototype.stageFail=function(){this.finished=!0,this.stage.dispatchEvent(GameProcessEvent.newInstance("STAGE_END",!1));var e=GameProcessEvent.newInstance("GAME_END",!1);this.stage.dispatchEvent(e)},e.prototype._resetFields=function(){this.balls=[],this.entityMap={},this.touchZone=null,this.bat=null,this.finished=!1,null!=this.stage&&this.stage.removeChildren()},e.prototype.initStage=function(e){this._resetFields(),this.bat=new Bat(this.stage),console.log("bat height"+this.bat.y),this.stage.addChild(this.bat);var t=new Ball(this.bat.x,this.bat.y-20);this.balls.push(t),this.stage.addChild(t),(null==e||void 0==e)&&(console.log("[error] stageConfig not exist!"),e=RES.getRes("demo_json"));var n=e.configurables;"string"==typeof n&&(n=JSON.parse(n));for(var a=0,i=n;a<i.length;a++){var s=i[a];if(null!=s.type&&null!=getConfigurableByType(s.type)){var r=newInstance(getConfigurableByType(s.type),s);this.stage.addChild(r),this.addToEntityMap(r)}}this.touchZone=new egret.Shape,this.touchZone.name="startTrigger",this.touchZone.graphics.beginFill(65280,0),this.touchZone.graphics.drawRect(0,0,this.stage.stage.stageWidth,2*(this.stage.stage.stageHeight-this.bat.y)),this.touchZone.graphics.endFill(),this.touchZone.x=0,this.touchZone.y=2*this.bat.y-this.stage.stage.stageHeight,this.touchZone.width=this.stage.width,this.touchZone.touchEnabled=!0,this.stage.addChild(this.touchZone),this.deadZone=new egret.Shape,this.deadZone.name="deadZone",this.deadZone.graphics.beginFill(1644912,.2),this.deadZone.graphics.drawRect(0,0,this.stage.width,100),this.deadZone.graphics.endFill(),this.deadZone.x=0,this.deadZone.y=this.bat.y+(this.stage.height-this.bat.y)/2,this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onInitTouchMoveListener,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onInitTouchMoveListener,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchTapInitBegin,this),this.stage.dispatchEvent(new GameProcessEvent("STAGE_START"))},e.prototype.onTouchTapInitBegin=function(e){egret.log("on onTouchTapInitBegin begin");for(var t=RES.getRes("myGame_json"),n=0,a=this.balls;n<a.length;n++){var i=a[n];i.speedY=t.ballInitSpeedY,i.speedX=t.ballInitSpeedX}this.stage.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onInitTouchMoveListener,this),this.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onInitTouchMoveListener,this),this.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchTapInitBegin,this),this.touchZone.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchTapPlaying,this),this.touchZone.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchTapPlaying,this)},e.prototype.onInitTouchMoveListener=function(e){if(null!=this.bat){this.bat.x=e.stageX;for(var t=0,n=this.balls;t<n.length;t++){var a=n[t];a.x=this.bat.x}}},e.prototype.update=function(e){for(var t=0,n=this.balls;t<n.length;t++){var a=n[t];this.debugLine.graphics.moveTo(a.x,a.y),a.update(e),this.debugLine.graphics.lineTo(a.x,a.y);var i=a.getTransformedBounds(this.stage);this.debugLine.graphics.drawRect(i.x,i.y,i.width,i.height),this.debugLine.graphics.endFill();var s=a.getTransformedBounds(this.stage),r=this.deadZone.getTransformedBounds(this.stage);if(r.intersects(s)){this.stage.removeChild(a);var o=this.balls.indexOf(a);this.balls.splice(o,1),this.isStageFail()&&this.stageFail()}var h=this.bat.getTransformedBounds(this.stage);if(h.intersects(s)&&this.bat.onHit(a),null!=this.entityMap[WALL])for(var g=0,c=this.entityMap[WALL];g<c.length;g++){var l=c[g],u=l.getTransformedBounds(this.stage);u.intersects(s)&&a.collitionTag<e&&(l.onHit(a),a.collitionTag=e)}if(null!=this.entityMap[BRICK])for(var p=0,d=this.entityMap[BRICK];p<d.length;p++){var f=d[p],v=f.getTransformedBounds(this.stage);v.intersects(s)&&a.collitionTag<e&&(f.onHit(a),a.collitionTag=e,this.isStageSuccess()&&this.stageSuccess())}}return!1},e.prototype.onTouchTapPlaying=function(e){null!=this.bat&&(this.bat.x=e.stageX)},e.gm=new e,e}();__reflect(GameManager.prototype,"GameManager");var BRICK="brick",WALL="wall",BAT="bat",BALL="ball",type2nameMap={100:BRICK,200:WALL},configuableMap=(_a={},_a[BRICK]=Brick,_a[WALL]=Wall,_a),_a,LoadingUI=function(e){function t(){var t=e.call(this)||this;return t.createView(),t}return __extends(t,e),t.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},t.prototype.onProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var LoginUI=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(egret.TouchEvent.TOUCH_END,t.onStart,t,!1),t}return __extends(t,e),t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.anchorOffsetX=this.width/2,this.x=this.stage.stageWidth/2,this.y=.2*this.stage.stageHeight;var t=this.stageNum;t.text=PlayerMng.getInstance().chap+"_"+PlayerMng.getInstance().index;var n=this.stage.mcFactory,a=new egret.MovieClip(n.generateMovieClipData("start_btn_pressed"));this.startGroup.addChild(a),this.scaleX=128/a.width,this.scaleY=128/a.height,a.gotoAndPlay(0,-1)},t.prototype.onStart=function(e){"startGroup"==e.target.name&&(this.dispatchEvent(new GameProcessEvent("GAME_START")),GameManager.getInstance().initStage(StageMng.getInstance().getCurrentStage()))},t.prototype.updateStageIndex=function(){var e=this.stageNum;e.text=PlayerMng.getInstance().chap+"-"+PlayerMng.getInstance().index},t}(eui.Component);__reflect(LoginUI.prototype,"LoginUI",["eui.UIComponent","egret.DisplayObject"]);var GAME_RATIO=.6,Main=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.UIlayer=t,t.pause=!1,t}return __extends(t,e),t.getInstance=function(){return t.instance},t.prototype.createChildren=function(){var n=this;e.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(e){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()},null==t.instance&&(t.instance=this);var a=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",a),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.addEventListener(egret.Event.RESIZE,function(e){console.log("in resize"),console.log("windowwidth:"+window.innerWidth),console.log("windowheight:"+window.innerHeight),console.log("stagewidth:"+n.stage.width),console.log("stageheight:"+n.stage.height)},this);var i=this;this.runGame()["catch"](function(e){console.log(e)}).then(function(){return egret.startTick(i.update,i)})},t.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,a,i,s=this;return __generator(this,function(r){switch(r.label){case 0:return[4,this.loadResource()];case 1:return r.sent(),[4,RES.getResAsync("description_json")];case 2:return e=r.sent(),this._createBG(),t=new eui.Label,t.x=.5*this.stage.stageWidth,t.y=.2*this.stage.stageHeight,t.width=128,t.height=128,t.text="用户授权",t.verticalAlign=egret.VerticalAlign.MIDDLE,t.textColor=2693020,t.stroke=2,t.strokeColor=5720253,t.background=!0,t.backgroundColor=11517258,t.alpha=.8,this.addChild(t),[4,platform.login()];case 3:return r.sent(),[4,platform.getUserInfo((t.x-64)/this.stage.stageWidth,.2,128/this.stage.stageWidth,128/this.stage.stageHeight)];case 4:return n=r.sent(),console.log(n),this.removeChild(t),[4,this.createGameScene()];case 5:return r.sent(),[4,RES.getResAsync("myGame_json")];case 6:return a=r.sent(),PlayerMng.getInstance().chap<=0&&(GameManager.getInstance().init(this.gameGroup,a),PlayerMng.getInstance().chap=a.initChap,PlayerMng.getInstance().index=a.initIndex),[4,StageMng.getInstance().init()];case 7:return i=r.sent(),this.loginUI.updateStageIndex(),this.addEventListener(GameProcessEvent.GAME_END,function(e){if(PlayerMng.getInstance().chap=a.initChap,PlayerMng.getInstance().index=a.initIndex,s.loginUI.updateStageIndex(),s.pauseBtn.visible=!1,e.data){var t=new egret.TextField;t.text="YOU WIN,NOW HAPPY?",t.textColor=16711727,t.size=60,t.verticalAlign=egret.VerticalAlign.MIDDLE,t.alpha=0,s.addChild(t),t.height=500,t.width=300,t.anchorOffsetX=t.width/2,t.anchorOffsetY=t.height/2,t.wordWrap=!0,t.multiline=!0,t.type=egret.TextFieldType.INPUT,t.x=s.stage.stageWidth/2,t.y=s.stage.stageHeight/3;egret.Tween.get(t).to({alpha:1},1e3,egret.Ease.circIn).wait(700).call(function(){var e=new egret.Bitmap;e.texture=RES.getRes("SAD_SCENE"),e.anchorOffsetX=e.width/2,e.anchorOffsetY=e.height/2,e.x=s.stage.stageWidth/2,e.y=s.stage.stageHeight/2,e.fillMode=egret.BitmapFillMode.SCALE,s.addChild(e);var n=function(a){s.removeChild(t),s.removeChild(e),s.loginUI.visible=!0,s.gameGroupMask.visible=!0,s.removeEventListener("touchTap",n,s)};s.addEventListener("touchTap",n,s)});egret.Tween.get(s.gameGroup).to({alpha:0},1e3)}else{var t=new egret.TextField;t.text="YOU DIE",t.textColor=16711727,t.size=60,t.verticalAlign=egret.VerticalAlign.MIDDLE,t.alpha=0,t.anchorOffsetX=t.width/2,t.anchorOffsetY=t.height/2,s.addChild(t),t.x=s.stage.stageWidth/2,t.y=s.stage.stageHeight/3;egret.Tween.get(t).to({alpha:1},1500,egret.Ease.circIn).wait(700).call(function(){var e=new egret.Bitmap;e.texture=RES.getRes("FAIL_SCENE"),e.anchorOffsetX=e.width/2,e.anchorOffsetY=e.height/2,e.x=s.stage.stageWidth/2,e.y=s.stage.stageHeight/2,e.fillMode=egret.BitmapFillMode.SCALE,s.addChild(e);var n=function(a){s.removeChild(t),s.removeChild(e),s.loginUI.visible=!0,s.gameGroupMask.visible=!0,s.removeEventListener("touchTap",n,s)};s.addEventListener("touchTap",n,s)});egret.Tween.get(s.gameGroup).to({alpha:0},1e3)}},this),this.addEventListener(GameProcessEvent.STAGE_END,function(e){if(e.data&&!StageMng.getInstance().isLastStage()){s.pauseBtn.visible=!1;var t=new egret.Bitmap;t.texture=RES.getRes("WIN_SCENE"),t.fillMode=egret.BitmapFillMode.SCALE,t.anchorOffsetX=t.width/2,t.anchorOffsetY=t.height/2,t.x=s.stage.stageWidth/2,t.y=s.stage.stageHeight/2,s.addChild(t);var n=function(e){s.removeChild(t),s.removeEventListener("touchEnd",n,s);var a=StageMng.getInstance().getNextStage();GameManager.getInstance().initStage(a),PlayerMng.getInstance().chap=parseInt(a.chap),PlayerMng.getInstance().index=parseInt(a.index)};s.addEventListener("touchEnd",n,s),egret.Tween.get(s.gameGroup).to({alpha:0},1e3)}},this),this.addEventListener(GameProcessEvent.STAGE_START,function(){s.loginUI.visible=!1,s.gameGroupMask.visible=!1,s.pauseBtn.visible=!0,egret.Tween.get(s.gameGroup).to({alpha:1},1e3)},this),this.addEventListener(GameProcessEvent.STAGE_PAUSED,function(){},this),this.addEventListener(GameProcessEvent.STAGE_RETURN,function(){s.loginUI.visible=!1,s.gameGroupMask.visible=!1},this),this.dispatchEvent(GameProcessEvent.newInstance("GAME_START")),[2]}})})},t.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,a,i;return __generator(this,function(s){switch(s.label){case 0:return s.trys.push([0,4,,5]),e=new LoadingUI,this.stage.addChild(e),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return s.sent(),[4,RES.loadGroup("preload",0,e)];case 2:return s.sent(),[4,this.loadTheme()];case 3:return s.sent(),t=RES.getRes("MovieClips_png"),n=RES.getRes("MovieClips_json"),a=new egret.MovieClipDataFactory(n,t),this.stage.mcFactory=a,this.stage.removeChild(e),[3,5];case 4:return i=s.sent(),console.error(i),[3,5];case 5:return[2]}})})},t.prototype.loadTheme=function(){var e=this;return new Promise(function(t,n){egret.ImageLoader.crossOrigin="anonymous";var a=new eui.Theme("resource/default.thm.json",e.stage);a.addEventListener(eui.UIEvent.COMPLETE,function(){t()},e)})},t.prototype.update=function(e){return this.pause||GameManager.getInstance().update(e),!1},t.prototype._createBG=function(){var e=Utils.createBitmapByName("BG_COMMON");e.fillMode=egret.BitmapFillMode.SCALE,this.addChild(e),e.width=this.stage.stageWidth,e.height=this.stage.stageHeight},t.prototype.createGameScene=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,a,i=this;return __generator(this,function(s){return e=this.stage.stageWidth,t=this.stage.stageHeight,this.gameGroup=new eui.Group,this.gameGroup.width=this.width,this.gameGroup.height=this.height,this.addChild(this.gameGroup),this.gameGroupMask=new eui.Group,this.gameGroupMask.alpha=0,n=new egret.Shape,n.width=this.stage.stageWidth,n.height=this.stage.stageHeight,n.graphics.beginFill(16711680,.2),n.graphics.drawRect(0,0,this.stage.stageWidth,this.stage.stageHeight),n.graphics.endFill(),this.gameGroupMask.touchChildren=!1,this.gameGroupMask.touchThrough=!1,this.gameGroupMask.addChild(n),this.addChild(this.gameGroupMask),this.loginUI=new LoginUI,this.addChild(this.loginUI),this.pauseBtn=new egret.Bitmap,this.pauseBtn.visible=!1,this.pauseBtn.texture=RES.getRes("PAUSE_BTN"),this.pauseBtn.width=32,this.pauseBtn.height=32,this.addChild(this.pauseBtn),this.pauseBtn.x=e-this.pauseBtn.width-5,this.pauseBtn.y=5,this.pauseBtn.touchEnabled=!0,a=function(){egret.Tween.get(i.gameGroupMask).to({alpha:0},600).call(function(){i.gameGroupMask.visible=!1,i.pause=!1}),i.pauseBtn.texture=RES.getRes("PAUSE_BTN"),i.gameGroupMask.hasEventListener("touchEnd")&&i.gameGroupMask.removeEventListener("touchEnd",a,i)},this.pauseBtn.addEventListener("touchEnd",function(){i.pause?a():(i.pause=!0,i.gameGroupMask.visible=!0,egret.Tween.get(i.gameGroupMask).to({alpha:0},0).to({alpha:1},600),i.gameGroupMask.addEventListener("touchEnd",a,i),i.pauseBtn.texture=RES.getRes("RESUME_BTN"),i.dispatchEvent(GameProcessEvent.newInstance("STAGE_PAUSED")))},this),[2]})})},t.prototype.onButtonClick=function(e){var t=new eui.Panel;t.title="Title",t.horizontalCenter=0,t.verticalCenter=0,this.addChild(t)},t}(eui.UILayer);__reflect(Main.prototype,"Main");var Utils=function(){function e(){}return e.createBitmapByName=function(e){var t=new egret.Bitmap,n=RES.getRes(e);return t.texture=n,t},e}();__reflect(Utils.prototype,"Utils");var DebugPlatform=function(){function e(){}return e.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,{nickName:"username"}]})})},e.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var GameProcessEvent=function(e){function t(t,n){return void 0===n&&(n=!1),e.call(this,t,!0,n)||this}return __extends(t,e),t.newInstance=function(e,n){var a=new t(e);return a.data=n,a},t.GAME_START="GAME_START",t.STAGE_START="STAGE_START",t.STAGE_END="STAGE_END",t.GAME_END="GAME_END",t.STAGE_PAUSED="STAGE_PAUSED",t.STAGE_RETURN="STAGE_RETURN",t}(egret.Event);__reflect(GameProcessEvent.prototype,"GameProcessEvent");var PlayerMng=function(){function e(){this.chap=-1,this.index=-1}return e.getInstance=function(){return e.playerMng},e.playerMng=new e,e}();__reflect(PlayerMng.prototype,"PlayerMng");var StageMng=function(){function e(){this.stageMap={}}return e.prototype.init=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(n){switch(n.label){case 0:return[4,RES.loadGroup("stage",8).then(function(){for(var n=RES.getGroupByName("stage"),a=0,i=n;a<i.length;a++){var s=i[a],r=RES.getRes(s.name),o=e.createKey(r.chap,r.index);t.stageMap[o]=r}})];case 1:return n.sent(),[2]}})})},e.getInstance=function(){return e.stageMng},e.createKey=function(e,t){return e+","+t},e.prototype.getByChapAndIndex=function(t,n){var a=e.createKey(t,n);return this.stageMap[a]},e.prototype.getCurrentStage=function(){var t=e.createKey(PlayerMng.getInstance().chap,PlayerMng.getInstance().index);return this.stageMap[t]},e.prototype.getNextStage=function(){if(this.isLastStage())return!1;var t=e.createKey(PlayerMng.getInstance().chap,PlayerMng.getInstance().index+1),n=this.stageMap[t];if(null==n){var a=e.createKey(PlayerMng.getInstance().chap+1,1);n=this.stageMap[a]}return n},e.prototype.isLastStage=function(){var t=e.createKey(PlayerMng.getInstance().chap,PlayerMng.getInstance().index+1),n=this.stageMap[t];if(null==n){var a=e.createKey(PlayerMng.getInstance().chap+1,1);n=this.stageMap[a]}return null==n},e.stageMng=new e,e}();__reflect(StageMng.prototype,"StageMng");var gifUI=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.partAdded=function(t,n){e.prototype.partAdded.call(this,t,n)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t}(eui.Component);__reflect(gifUI.prototype,"gifUI",["eui.UIComponent","egret.DisplayObject"]);